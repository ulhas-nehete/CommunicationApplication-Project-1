<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Communication Application</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="styles/style.css" rel="stylesheet" />    
</head>
<body>
    <div class="container">
        <nav class="navbar">
            <a href="chatList.html" class="active">Group Chat</a>
            <a href="userList.html">Manage Users</a>
            <a href="documentList.html">Manage Documents</a>
            <a onclick="userLogout()" class="userLogout">Logout</a>   
        </nav>
        <h1 class="text-left">Group Chat</h1>
        <div class="chatBox">
            <div  class="chatMessageBlock">
                <script>                
                    let allGroupChat = JSON.parse(localStorage.getItem("allGroupChat")) || [];
                    let loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));

                    let htmlContent = "";
                    for (let i = 0; i < allGroupChat.length; i++) {

                        let messageClass = loggedInUser && loggedInUser.fullname === allGroupChat[i].fullname ? 'message-right' : '';
                        htmlContent += `<div class="${messageClass}">                   
                                            <div>
                                                <span>[${allGroupChat[i].dateTime}]</span>
                                                <span>${allGroupChat[i].fullname} : </span>
                                                <span>${allGroupChat[i].userChatMessage}</span>
                                            </div>
                                        </div>`;
                    }
                    document.write(htmlContent);

                     // Scroll to the bottom
                    function scrollToBottom() {
                        $('.chatMessageBlock').scrollTop($('.chatMessageBlock')[0].scrollHeight);
                    }
                    scrollToBottom();
                    setTimeout(function() {scrollToBottom();}, 2000);

                </script>
            </div>
            <div class="chatForm">
                <form action="" method="get" novalidate onsubmit="return groupChat()">
                    <strong id="fullname"></strong><span id="email" class="d-none"></span>
                    <div class="w-100">
                        <input type="text" placeholder="Type here..." name="userChatMessage" id="userChatMessage" class="form-control" />
                        <span id="chatMessageError" class="error"></span>
                    </div>
                    <button class="btn btn-default">Send</button>
                    <a class="btn btn-default" onclick="window.location.reload();">Refresh</a>
                </form>
            </div>
        </div>
    </div>
    <script src="./scripts/script.js"></script>
</body>
</html>

